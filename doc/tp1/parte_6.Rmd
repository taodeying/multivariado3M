---
title: "Ejercicio 6"
output: 
  pdf_document:
    extra_dependencies: ["float"]
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, message = FALSE, warning = FALSE, fig.align = "center"
)
```

## Librerias

```{r}
library(cluster)
library(FactoMineR)
library(ggrepel)
library(kableExtra)
library(tidyverse)
source(here::here("src", "utils.R"))
```

## Datos

```{r}
datos_q <- read_csv2(here::here("data", "raw", "CUALITATIVAS.csv"))
datos_c <- read_csv2(here::here("data", "raw", "CUANTITATIVAS.csv"))
datos_m <- read_csv2(here::here("data", "raw", "RAPDS.csv"))
```


```{r}
colnames(datos_c)[1] <- "VARIEDAD"
```

**A.** Mida la concordancia entre las configuraciones en el plano principal 
obtenidas en los ejercicios 2, 3 y 5

Primero tenemos que correr los analisis nuevamente.

**Ejercicio 2**

```{r}

datos_2<-readRDS(here::here("doc", "tp1","shared", "parte_2", "matriz_distancia.rds"))
coordenadas_principales <- cmdscale(sqrt(datos_2), eig = TRUE)
datos_2 <- as.data.frame(coordenadas_principales$points)
datos_2_dist<-dist(datos_2, method = "euclidean", diag = TRUE)

```

**Ejercicio 3**

```{r}
datos_3<-readRDS(here::here("doc", "tp1","shared", "parte_3", "Coordenadas_1y2_pp_Clusters.rds"))%>%
  select("c1", "c2")
datos_3_dist<-dist(datos_3, method = "euclidean", diag = TRUE)
```

**Ejercicio 5**

```{r}

datos_5<-readRDS(here::here("doc", "tp1","shared", "parte_5", "matriz_distancia.rds"))
coordenadas_principales <- cmdscale(datos_5, eig = TRUE, k=2)
datos_5 <- as.data.frame(coordenadas_principales$points)
datos_5_dist<-dist(datos_5, method = "euclidean", diag = TRUE)

```


Concordancia entre lo obtenido entre el ejer 2 y 3 (VER, ESCRIBIR EN TERMINOS DEL PROBLEMA)
```{r}
cor(datos_2_dist, datos_3_dist)%>%
  round(2)%>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE) %>%
  kable_classic_2() 

```

Concordancia entre lo obtenido entre el ejer 2 y 5 (VER, ESCRIBIR EN TERMINOS DEL PROBLEMA)
```{r}
cor(datos_2_dist, datos_5_dist)%>%
  round(2)%>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE) %>%
  kable_classic_2() 

```

Concordancia entre lo obtenido entre el ejer 3 y 5 (VER, ESCRIBIR EN TERMINOS DEL PROBLEMA)
```{r}
cor(datos_3_dist, datos_5_dist)%>%
  round(2)%>%
  kable(align = "c") %>%
  kable_styling(full_width = FALSE) %>%
  kable_classic_2() 

```

**B.** Mida la concordancia entre la caracterización agronómica 
(cualitativa + cuantitativa) y molecular (planos principales)

```{r}

```

**C.** Con APG halle el consenso entre las configuraciones (plano principal) 
obtenidas en base a datos cualitativos, cuantitativos y moleculares.


```{r}
df = cbind(
  datos_2,
  datos_3,
  datos_5
) %>%
  as.data.frame()%>%
  round(2)

colnames(df) = c("C1", "C2", "Q1", "Q2", "M1", "M2")

gpa <- GPA(
  df, 
  group = c(2, 2, 2), 
  name.group = c("Cuantiativa", "Cualitativa", "Molecular"),
  graph = TRUE, 
  axes = c(1,2)
)
```

**D.** Identifique si hay algún tipo de pepino para el cual hay más discrepancia
entre estas tres caracterizaciones


```{r}
#anova por variedad
#ordenar de menor a mayor
gpa$PANOVA$objet

gpa$PANOVA$config
#para saber si hay algun tipo de pepino, se puede hacer promedio de distancia por pepino

```


**E.** Finalice el análisis con un cluster UPGMA obtenido a partir de la 
configuración de consenso

```{r}

dist<-dist(df, method = "euclidean")
cluster_upgma<-hclust( dist, method = "average")
cluster_upgma_data<- dendro_data_k(cluster_upgma, k=4)

ggplot(cluster_upgma_data$segments) + 
  geom_segment(
    aes(x = x, y = y, xend = xend, yend = yend, color = as.factor(clust)),
    size = 1.2,
    lineend = "round"
  ) + 
  geom_text(
    aes(x = x, y = y - 0.40, label = label, color = as.factor(clust)), 
    data = cluster_upgma_data$labels
  ) + 
  coord_flip() + 
  labs(
    y = "Distancia"
  ) + 
  scale_colour_manual(
    values = c("grey30", scales::hue_pal()(4))
  ) + 
  theme(
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    panel.background = element_blank(),
    axis.title.x = element_text(size = 14), 
    axis.title.y = element_blank(), 
    axis.text.x = element_text(size = 12),
    axis.text.y = element_blank(), 
    axis.line = element_blank(), 
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )
```


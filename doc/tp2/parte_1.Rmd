---
title: "Ejercicio 1"
output: 
  pdf_document:
    extra_dependencies: ["float"]
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, fig.align = "center",
  fig.pos = "H", out.extra = "", fig.height = 3.5, fig.width = 5
)
colores <- c("#003f5c", "#7a5195", "#ef5675", "#ffa600")
```

```{r}
library(FactoMineR)
library(ggplot2)
# library(ggforce)
# library(ggrepel)
library(kableExtra)
# library(patchwork)
# library(tidyverse)
# library(vegan)
# source(here::here("src", "utils.R"))
```

```{r}
datos_m1 <- read.csv2(
  here::here("data", "raw", "MAIZ1.csv"), 
  row.names = 1, 
  stringsAsFactors = FALSE
)

datos_m2 <- read.csv2(
  here::here("data", "raw", "MAIZ2.csv"), 
  row.names = 1, 
  stringsAsFactors = FALSE
)

datos <- cbind(datos_m1, datos_m2)
```

A) En el ejercicio 7b TP Parte I, se realizó un ACP por cada ambiente. ¿Cuánto 
vale el primer autovalor de cada ACP? ¿Qué ocurriría si se hace un ACP de los 
ambientes concatenados pero sin utilizar la ponderación del AFM?
    
    En el caso del ambiente Pergamino el primer autovalor es 4.67, y en el caso 
    del ambiente Ferre es 3.62.

    Si concateno las matrices sin realizar la ponderacion del AFM, el ambiente
    Pergamino va a tener mayor peso que el ambiente Ferre en la construccion de
    un ACP de compromiso porque su primer autovalor, que representa la varianza
    en la primer direccion principal, es mayor.
    
    En cambio, al ponderar a cada tabla por el inverso del primer autovalor, 
    el primer autovalor de cada tabla ponderada es 1 y en consecuencia cada
    ambos ambientes tienen el mismo peso en el ACP global.
    
    Realice un AFM y responda las siguientes cuestiones: 
  

    ```{r}
    mfa <- MFA(
      base = datos, 
      group = c(10, 10), 
      type = c("s", "s"), 
      name.group = c("Pergamino", "Ferre"),
      graph = FALSE
    )
    ```  
    
A) ¿Cuál es el porcentaje de explicación del plano principal? 

    El porcentaje de variabilidad explicada en el plano princial es 
    `r paste0(round(mfa$eig[2, 3], 2), "%")`.

A) ¿Qué puede decir a partir de los coeficientes RV, Lg y Ng? Analice el gráfico 
de los ambientes (condiciones). 

    ```{r}
    kable(
      mfa$group$RV, 
      digits = 3,
      align = "c",
      caption = "Coeficiente RV"
    ) %>% 
    kable_styling(font_size = 10, latex_options = "HOLD_position") %>% 
    kable_classic_2() 
    ```

    ```{r}
    kable(
      mfa$group$Lg, 
      digits = 3,
      align = "c",
      caption = "Coeficiente $L_g$",
      format = "latex"
    ) %>% 
    kable_styling(font_size = 10, latex_options = "HOLD_position") %>% 
    kable_classic_2() 
    ```

    En la tabla 1, vemos que el coeficiente $RV$ entre los ambientes Pergamino
    y Ferre es de 0.57. Esto significa que las configuraciones de las variedades
    de maiz en ambos ambientes son medianamente similares. En otras palabras,
    si bien no hay un desentendimiento total entre estas dos configuraciones,
    tampoco presentan estructuras homoteticas^[En criollo podriamos decir _ni tan tan, ni muy muy_.].
    Por otro lado, los valores del coeficiente $RV$ entre las representaciones
    parciales de cada ambiente y la representacion promedio del AFM es de
    0.87  para Pergamino y 0.90 para Ferre. Estos valores indican que la 
    representacion de consenso se parece bastante a las representaciones
    parciales de cada ambiente.

    En cuanto a la tabla 2, vemos que el mayor valor del coeficiente $L_g$ lo 
    presenta el ambiente Ferre. Esto significa que este ambiente aporta una 
    descripcion mas rica que el ambiente Pergamino.
    
    Los coeficientes $N_g$, es decir, la raiz cuadrada del coeficiente $L_g$
    de un grupo respecto de si mismo, son 1.12 y 1.3 para Pergamino y Ferre,
    respectivamente. Esto significa que el ambiente Pergamino aporta casi de
    manera exclusiva en una sola dimension, mientras que el ambiente Ferre 
    tiene una dimensionalidad un poco mayor a 1, por lo que aporta un poco
    en una segunda dimension.
    
    Naturalmente, la informacion obtenida mediante el coeficiente $N_g$ es 
    redundante con lo que concluimos mediante el coeficiente $L_g$. En otras
    palabras, en el ambiente Ferre se tiene una descripcion mas rica y 
    menos redundante de las variedades de maiz que en el ambiente Pergamino. 
    
    ```{r}
    d = as.data.frame(mfa$group$coord)[, 1:2]
    d$ambiente = rownames(d)
    rownames(d) = NULL
    colnames(d) = c("x", "y", "ambiente")
    
    ggplot(d) +
      geom_point(aes(x, y, color = ambiente), size = 3) + 
      geom_label(aes(x, y, label = ambiente), nudge_x = -0.075, nudge_y = -0.075) + 
      geom_hline(yintercept = 0, linetype = "dashed", color = "gray30", alpha = 0.5) +
      geom_vline(xintercept = 0, linetype = "dashed", color = "gray30", alpha = 0.5) +
      scale_color_manual(values = colores[c(1, 4)], guide = FALSE) + 
      labs(
        x = "Coordenada 1 (37.33%)",
        y = "Coordenada 2 (14.58%)",
        title = "Representacion de los ambientes"
      ) +
      lims(x = c(0, 1), y = c(0, 1))
    ```
    
    En el grafico de los ambientes se puede ver que ambos ambientes tienen
    relacion muy alta con la primer coordenada, y que solamente el ambiente
    Ferre tiene relacion con la segunda coordenada. Esto es consistente con lo
    que pudimos apreciar mediante el coeficiente $N_g$, donde vimos que la 
    dimensionalidad del ambiente Pergamino era practicamente 1, mientras que 
    la del ambiente Ferre era mayor.

    
A) Analice si encuentra indicios de interacción tanto genotipo-ambiente como 
variable-ambiente. 



A) ¿Cuáles son las poblaciones que tuvieron un comportamiento más diferenciado 
entre ambos ambientes en el plano principal? (nombrar 5 para cada dimensión). 


A) ¿Cuáles son las variables que más contribuyen a la determinación de los ejes? 


A) Busque en el Help de R el comando HCPC. Utilícelo con los datos de este 
ejercicio y comente el resultado (Usar UPGMA). 


A) Arme grupos de individuos y realice una caracterización. 


A) Obtenga la matriz de distancias euclídeas entre individuos en el plano 
principal del AFM. Compare dicha matriz con la obtenida a partir de APG. 